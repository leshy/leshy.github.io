<!doctype html>
<html
  xmlns="http://www.w3.org/1999/xhtml"
  lang=""
  xml:lang=""
  >
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
        <meta name="author" content="Ivan Nikolic" />
           <title>Battery Design</title>
        <link rel="stylesheet" href="/reset.css" />
        <link rel="stylesheet" href="/index.css" />
      
  </head>
  <body>
    
    <table class="header">
      <tr>
        <td colspan="2" rowspan="2" class="width-auto">
          <h1 class="title">Battery Design</h1>
          <span class="subtitle"></span>
        </td>
        <th>Version</th>
        <td class="width-min">v0.1 alpha</td>
      </tr>
      <tr>
        <th>Created</th>
        <td class="width-min">
          <time style="white-space: pre">[2024-12-02 Mon]</time>
        </td>
      </tr>
      <tr>
        <th class="width-min">Author</th>
        <td class="width-auto">
          <a href=""><cite>Ivan Nikolic</cite></a>
        </td>
        <th class="width-min">Updated</th>
        <td>[2024-12-02 Mon]</td>
      </tr>
    </table>
    <label class="debug-toggle-label"
      ><input type="checkbox" class="debug-toggle" /> Debug mode</label
    >
         <nav id="TOC" role="doc-toc">
            <h2 id="toctitle">Contents</h2>

       <ul>
<li><a href="#cell-selection" id="toc-cell-selection">Cell
selection</a></li>
<li><a href="#full-pack-performanceprice"
id="toc-full-pack-performanceprice">Full pack performance/price</a></li>
<li><a href="#thermal-performance-of-the-cells"
id="toc-thermal-performance-of-the-cells">Thermal performance of the
cells</a></li>
<li><a href="#copper-bus-bar-and-cabling"
id="toc-copper-bus-bar-and-cabling">Copper bus bar and cabling</a></li>
<li><a href="#aluminium-bus-bar" id="toc-aluminium-bus-bar">Aluminium
Bus Bar</a></li>
<li><a href="#d-models" id="toc-d-models">3D Models</a></li>
<li><a href="#pack-1-option" id="toc-pack-1-option">Pack 1 Option</a>
<ul>
<li><a href="#model" id="toc-model">Model</a></li>
<li><a href="#details" id="toc-details">Details</a></li>
<li><a href="#bus-bar-1-design" id="toc-bus-bar-1-design">Bus Bar 1
Design</a></li>
<li><a href="#bus-bar-system-1-notes"
id="toc-bus-bar-system-1-notes">Bus Bar System 1 Notes</a></li>
<li><a href="#bus-bar-system-2-design"
id="toc-bus-bar-system-2-design">Bus Bar System 2 Design</a></li>
<li><a href="#bus-bar-system-2-considerations"
id="toc-bus-bar-system-2-considerations">Bus Bar System 2
Considerations</a></li>
</ul></li>
<li><a href="#pack-3-option" id="toc-pack-3-option">Pack 3 Option</a>
<ul>
<li><a href="#details-1" id="toc-details-1">Details</a></li>
<li><a href="#model-1" id="toc-model-1">Model</a></li>
<li><a href="#bus-bar-design" id="toc-bus-bar-design">Bus Bar
Design</a></li>
</ul></li>
<li><a href="#other-details" id="toc-other-details">Other Details</a>
<ul>
<li><a href="#misc-safety" id="toc-misc-safety">Misc safety</a></li>
<li><a href="#cabling" id="toc-cabling">Cabling</a></li>
<li><a href="#diagram" id="toc-diagram">Diagram</a></li>
<li><a href="#cables" id="toc-cables">Cables</a></li>
<li><a href="#connectors" id="toc-connectors">Connectors</a></li>
<li><a href="#bus-bar-sizing" id="toc-bus-bar-sizing">Bus bar
sizing</a></li>
</ul></li>
<li><a href="#cell-level-fuse-research"
id="toc-cell-level-fuse-research">Cell level fuse research</a></li>
<li><a href="#exports-for-drawing" id="toc-exports-for-drawing">Exports
for drawing</a></li>
<li><a href="#resources" id="toc-resources">Resources</a></li>
</ul>
    </nav>
     <section id="cell-selection" class="level1">
<h1>Cell selection</h1>
<p>Collecting data on the individual cells from <a
href="https://eu.nkon.nl/">https://eu.nkon.nl/</a></p>
<table id="cells">
<thead>
<tr class="header">
<th>Name</th>
<th>Price (EUR)</th>
<th>Cap (Ah)</th>
<th>Weight (g)</th>
<th>Max (A)</th>
<th>Type</th>
<th>Height (mm)</th>
<th>D (mm)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>LG INR18650MH1</td>
<td>2.75</td>
<td>3.100</td>
<td>47</td>
<td>6</td>
<td>18650</td>
<td>64.5</td>
<td>18</td>
</tr>
<tr class="even">
<td>Sanyo NCR18650GA</td>
<td>3.9</td>
<td>3.450</td>
<td>47</td>
<td>10</td>
<td>18650</td>
<td>65</td>
<td>18</td>
</tr>
<tr class="odd">
<td>Keeppower IMR26650</td>
<td>8.95</td>
<td>5.200</td>
<td>93.9</td>
<td>15</td>
<td>26650</td>
<td>67</td>
<td>26</td>
</tr>
<tr class="even">
<td>Keeppower 26650</td>
<td>9.45</td>
<td>5.200</td>
<td>97</td>
<td>10</td>
<td>26650</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Lishen LR2170SD</td>
<td>3.8</td>
<td>4.800</td>
<td>73</td>
<td>9.6</td>
<td>21700</td>
<td>70.9</td>
<td>21.7</td>
</tr>
<tr class="even">
<td>Samsung INR21700</td>
<td>5.65</td>
<td>5.200</td>
<td>67</td>
<td>15</td>
<td>21700</td>
<td>70.6</td>
<td>21.27</td>
</tr>
<tr class="odd">
<td>Samsung INR21700-50S</td>
<td>3.16</td>
<td>5</td>
<td>72</td>
<td>35</td>
<td>21700</td>
<td>70.6</td>
<td>21.25</td>
</tr>
<tr class="even">
<td>Headway LifePO4</td>
<td>15</td>
<td>10.000</td>
<td>346</td>
<td>20</td>
<td>38120</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="full-pack-performanceprice" class="level1">
<h1>Full pack performance/price</h1>
<p>How many cells do I need to go in series to achieve &gt; 3kWh
capacity, then calculate max amps, weight etc</p>
<details><summary> python code block</summary><code><div class="sourceCode" id="cb1" data-var="tab=cells"
data-colnames="yes" data-hlines="yes" data-results="table"
data-exports="both" data-post="header(*this*)"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>cell_voltage <span class="op">=</span> <span class="fl">4.2</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>cell_series <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>target_kwh <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process(row):</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    [name, price, capacity, weight, maxA, batt_type, height, diam] <span class="op">=</span> row</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># full battery voltage (aiming for 72/84v)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    total_voltage <span class="op">=</span> (cell_voltage <span class="op">*</span> cell_series)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># required capacity (Ah) of a single series stage to achieve target kWh</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    single_series_ah <span class="op">=</span> (target_kwh <span class="op">*</span> <span class="dv">1000</span>) <span class="op">/</span> total_voltage</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># number of cells required in each stage</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    P <span class="op">=</span> math.ceil(single_series_ah <span class="op">/</span> capacity)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># total battery kWh</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    kWh <span class="op">=</span> (P <span class="op">*</span>  capacity <span class="op">*</span> total_voltage) <span class="op">/</span> <span class="dv">1000</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># total cells in the battery</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    cell_n <span class="op">=</span> P <span class="op">*</span> <span class="dv">20</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># full price, weight</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    total_price <span class="op">=</span> <span class="bu">round</span>(cell_n <span class="op">*</span> price)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    total_weight <span class="op">=</span> <span class="bu">round</span>(cell_n <span class="op">*</span> weight) <span class="op">/</span> <span class="dv">1000</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># max safe discharge</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    total_maxA <span class="op">=</span> P <span class="op">*</span> maxA</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [name, P, kWh, total_price, total_weight, total_maxA, cell_n]</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span>([[<span class="st">&#39;Name&#39;</span>, <span class="st">&#39;20SxP&#39;</span>, <span class="st">&#39;kWh&#39;</span>, <span class="st">&#39;Price (EUR)&#39;</span>, <span class="st">&#39;Weight (Kg)&#39;</span>, <span class="st">&#39;Max (A)&#39;</span>, <span class="st">&#39;Cell Count&#39;</span>]] <span class="op">+</span> </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>       [process(row) <span class="cf">for</span> row <span class="kw">in</span> tab])</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span></code></pre></div></code></details>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>20SxP</th>
<th>kWh</th>
<th>Price (EUR)</th>
<th>Weight (Kg)</th>
<th>Max (A)</th>
<th>Cell Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>LG INR18650MH1</td>
<td>12</td>
<td>3.1248</td>
<td>660</td>
<td>11.28</td>
<td>72</td>
<td>240</td>
</tr>
<tr class="even">
<td>Sanyo NCR18650GA</td>
<td>11</td>
<td>3.1878</td>
<td>858</td>
<td>10.34</td>
<td>110</td>
<td>220</td>
</tr>
<tr class="odd">
<td>Keeppower IMR26650</td>
<td>7</td>
<td>3.0576</td>
<td>1253</td>
<td>13.146</td>
<td>105</td>
<td>140</td>
</tr>
<tr class="even">
<td>Keeppower 26650</td>
<td>7</td>
<td>3.0576</td>
<td>1323</td>
<td>13.58</td>
<td>70</td>
<td>140</td>
</tr>
<tr class="odd">
<td>Lishen LR2170SD</td>
<td>8</td>
<td>3.2256</td>
<td>608</td>
<td>11.68</td>
<td>76.8</td>
<td>160</td>
</tr>
<tr class="even">
<td>Samsung INR21700</td>
<td>7</td>
<td>3.0576</td>
<td>791</td>
<td>9.38</td>
<td>105</td>
<td>140</td>
</tr>
<tr class="odd">
<td>Samsung INR21700-50S</td>
<td>8</td>
<td>3.36</td>
<td>506</td>
<td>11.52</td>
<td>280</td>
<td>160</td>
</tr>
<tr class="even">
<td>Headway LifePO4</td>
<td>4</td>
<td>3.36</td>
<td>1200</td>
<td>27.68</td>
<td>80</td>
<td>80</td>
</tr>
</tbody>
</table>
<p>Samsung INR21700 seems most promising:</p>
<ul>
<li>low price<br />
</li>
<li>only 8 cells in series<br />
</li>
<li>best performance in terms of max output (A) (implies very fast
charging as well)<br />
</li>
</ul>
<p>Building a 8P20S battery,<br />
Max continuous discharge of 150A giving 7.2/8.4kw - 10/12.6kw</p>
</section>
<section id="thermal-performance-of-the-cells" class="level1">
<h1>Thermal performance of the cells</h1>
<p>Since only 8P is used we have high per-cell discharge rate which
might cause thermal issues</p>
<details><summary> python code block</summary><code><div class="sourceCode" id="cb1" data-results="table"
data-session="battcalc" data-exports="both"
data-post="header(*this*)"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy <span class="im">import</span> Symbol, solve, expand, pi, lambdify</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Base parameters as symbols</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Geometric parameters</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>cell_d_mm <span class="op">=</span> Symbol(<span class="st">&#39;cell_d_mm&#39;</span>)    <span class="co"># diameter (mm)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>cell_h_mm <span class="op">=</span> Symbol(<span class="st">&#39;cell_h_mm&#39;</span>)    <span class="co"># height (mm)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>cell_r_mm <span class="op">=</span> cell_d_mm<span class="op">/</span><span class="dv">2</span>            <span class="co"># radius (mm)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>cell_r_m <span class="op">=</span> cell_r_mm <span class="op">/</span> <span class="dv">1000</span>        <span class="co"># radius (m)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>cell_d_m <span class="op">=</span> cell_d_mm <span class="op">/</span> <span class="dv">1000</span>        <span class="co"># diameter (m)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>cell_h_m <span class="op">=</span> cell_h_mm <span class="op">/</span> <span class="dv">1000</span>        <span class="co"># height (m)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Pack configuration</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>n_parallel <span class="op">=</span> Symbol(<span class="st">&#39;n_p&#39;</span>)         <span class="co"># number of cells in parallel</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>n_series <span class="op">=</span> Symbol(<span class="st">&#39;n_s&#39;</span>)           <span class="co"># number of cells in series</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>current <span class="op">=</span> Symbol(<span class="st">&#39;I&#39;</span>)              <span class="co"># total current (A)</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Cell electrical properties</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>cell_ir <span class="op">=</span> Symbol(<span class="st">&#39;R_cell&#39;</span>)         <span class="co"># internal resistance per cell (ohm)</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>voltage <span class="op">=</span> Symbol(<span class="st">&#39;V&#39;</span>)              <span class="co"># cell voltage (V)</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>cell_capacity <span class="op">=</span> Symbol(<span class="st">&#39;C_cell&#39;</span>)   <span class="co"># cell capacity (Ah)</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Thermal properties</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>temperature <span class="op">=</span> Symbol(<span class="st">&#39;T&#39;</span>)          <span class="co"># cell temperature (°C)</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>ambient_temp <span class="op">=</span> Symbol(<span class="st">&#39;T_a&#39;</span>)       <span class="co"># ambient temperature (°C)</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>cell_mass <span class="op">=</span> Symbol(<span class="st">&#39;m_cell&#39;</span>)       <span class="co"># cell mass (kg)</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>spec_heat <span class="op">=</span> Symbol(<span class="st">&#39;c_p&#39;</span>)          <span class="co"># specific heat capacity (J/kg°C)</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>thermal_cutoff <span class="op">=</span> Symbol(<span class="st">&#39;T_max&#39;</span>)   <span class="co"># thermal cutoff temperature (°C)</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>thermal_release <span class="op">=</span> Symbol(<span class="st">&#39;T_rel&#39;</span>)  <span class="co"># thermal release temperature (°C)</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>heat_transfer_coeff <span class="op">=</span> Symbol(<span class="st">&#39;h&#39;</span>)  <span class="co"># heat transfer coefficient W/(m²·K)</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Core relationships</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>cells_total <span class="op">=</span> n_series <span class="op">*</span> n_parallel</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>current_per_cell <span class="op">=</span> current <span class="op">/</span> n_parallel</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>pack_voltage <span class="op">=</span> n_series <span class="op">*</span> voltage</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>pack_power <span class="op">=</span> current <span class="op">*</span> pack_voltage</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Power and heat calculations</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>cell_power_loss <span class="op">=</span> current_per_cell<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> cell_ir</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>pack_power_loss <span class="op">=</span> cell_power_loss <span class="op">*</span> cells_total</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>pack_power <span class="op">=</span> current <span class="op">*</span> pack_voltage</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>efficiency <span class="op">=</span> (pack_power <span class="op">-</span> pack_power_loss) <span class="op">/</span> pack_power <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature calculations</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>cell_surface_area <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> pi <span class="op">*</span> cell_r_m<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> pi <span class="op">*</span> cell_r_m <span class="op">*</span> cell_h_m</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>temp_rise <span class="op">=</span> cell_power_loss <span class="op">/</span> (heat_transfer_coeff <span class="op">*</span> cell_surface_area)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to thermal cutoff calculation</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>thermal_time <span class="op">=</span> (cell_mass <span class="op">*</span> spec_heat <span class="op">*</span> (thermal_cutoff <span class="op">-</span> ambient_temp)) <span class="op">/</span> cell_power_loss</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Environment specification</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>env_spec <span class="op">=</span> {</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    ambient_temp: <span class="dv">40</span>,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    heat_transfer_coeff: <span class="dv">10</span>  <span class="co"># W/(m²·K) for natural convection</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Battery pack configuration</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>pack_spec <span class="op">=</span> {</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    n_parallel: <span class="dv">8</span>,</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    n_series: <span class="dv">20</span>,</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    cell_d_mm: <span class="dv">21</span>,</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    cell_h_mm: <span class="dv">70</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Cell specifications (Samsung 50S as default)</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>cell_spec <span class="op">=</span> { </span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    cell_ir: <span class="fl">0.014</span>,          <span class="co"># 14mΩ internal resistance</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    cell_mass: <span class="fl">0.072</span>,        <span class="co"># kg</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    voltage: <span class="fl">3.6</span>,            <span class="co"># V</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    cell_capacity: <span class="fl">5.0</span>,      <span class="co"># Ah</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    spec_heat: <span class="dv">850</span>,          <span class="co"># J/kg°C</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    thermal_cutoff: <span class="dv">80</span>,      <span class="co"># °C</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    thermal_release: <span class="dv">60</span>      <span class="co"># °C</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> format_time(x, _<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&lt;</span> <span class="dv">60</span>:</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&#39;</span><span class="sc">{</span>x<span class="op">*</span><span class="dv">60</span><span class="sc">:.0f}</span><span class="ss">s&#39;</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> x <span class="op">&lt;</span> (<span class="dv">3600</span>):</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>        minutes <span class="op">=</span> x <span class="op">/</span> <span class="dv">60</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&#39;</span><span class="sc">{</span>minutes<span class="sc">:.0f}</span><span class="ss">min&#39;</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>        hours <span class="op">=</span> x<span class="op">/</span>(<span class="dv">3600</span>)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> hours <span class="op">&lt;</span> <span class="dv">24</span>:</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f&#39;</span><span class="sc">{</span>hours<span class="sc">:.1f}</span><span class="ss">h&#39;</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>            days <span class="op">=</span> hours<span class="op">/</span><span class="dv">24</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f&#39;</span><span class="sc">{</span>days<span class="sc">:.1f}</span><span class="ss">d&#39;</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="co"># def calculate_losses(total_current):</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;&quot;&quot;Calculate losses for a given current&quot;&quot;&quot;</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="co">#     subs_dict = {**cell_spec, **pack_spec, **env_spec, current: total_current}</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="co">#     heat_per_cell = cell_power_loss.subs(subs_dict)</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="co">#     total_heat = pack_power_loss.subs(subs_dict)</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="co">#     eff = efficiency.subs(subs_dict)</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="co">#     temp_increase = temp_rise.subs(subs_dict)</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a><span class="co">#     time_to_cutoff = thermal_time.subs(subs_dict)</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a><span class="co">#     power = pack_power.subs(subs_dict)</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a><span class="co">#     voltage = pack_voltage.subs(subs_dict)</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f&quot;At {int(power)}W&quot;)</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f&quot;Total current: {total_current}A at {int(voltage)}V&quot;)</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f&quot;Current per cell: {total_current/pack_spec[n_parallel]:.2f}A&quot;)</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f&quot;Heat generation per cell: {heat_per_cell:.2f}W&quot;)</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f&quot;Pack efficiency: {eff:.2f}%&quot;)</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f&quot;Estimated temp rise above ambient: {temp_increase:.2f}°C&quot;)</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f&quot;Time to reach {cell_spec[thermal_cutoff]}°C (no cooling): {format_time(float(time_to_cutoff))}&quot;)</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(&quot;&quot;)</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a><span class="co"># # Example usage with different currents</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a><span class="co"># for test_current in [50, 100, 150]:</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a><span class="co">#     calculate_losses(test_current)</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>current_range <span class="op">=</span> np.linspace(<span class="dv">50</span>, <span class="dv">200</span>, <span class="dv">4</span>)</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>vals <span class="op">=</span> { <span class="op">**</span>cell_spec, <span class="op">**</span>pack_spec, <span class="op">**</span>env_spec, current: current_range}</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> round_row(<span class="op">*</span>row):</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [ <span class="ss">f&quot;</span><span class="sc">{</span>item<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> item <span class="kw">in</span> row]</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> [<span class="st">&quot;I (A)&quot;</span>, <span class="st">&quot;Out (kW)&quot;</span>, <span class="st">&quot;T(overload)&quot;</span>, <span class="st">&quot;η (%)&quot;</span>, <span class="st">&quot;cell loss (W)&quot;</span>, <span class="st">&quot;pack loss (W)&quot;</span>]</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> compute(vals, [ pack_power, thermal_time, efficiency, cell_power_loss, temp_rise ])</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>rows[<span class="dv">0</span>] <span class="op">=</span> <span class="bu">map</span>(<span class="kw">lambda</span> x: x<span class="op">/</span><span class="dv">1000</span>, rows[<span class="dv">0</span>])</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>rows[<span class="dv">1</span>] <span class="op">=</span> <span class="bu">map</span>(format_time, rows[<span class="dv">1</span>])</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>rows[<span class="dv">2</span>] <span class="op">=</span> <span class="bu">map</span>(<span class="bu">int</span>, rows[<span class="dv">2</span>])</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>rows[<span class="dv">3</span>] <span class="op">=</span> <span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f&quot;</span><span class="sc">{</span>x<span class="sc">:.2f}</span><span class="ss">&quot;</span>, rows[<span class="dv">3</span>])</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>rows[<span class="dv">4</span>] <span class="op">=</span> <span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f&quot;</span><span class="sc">{</span>x<span class="sc">:.2f}</span><span class="ss">&quot;</span>, rows[<span class="dv">4</span>])</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>[headers, <span class="op">*</span><span class="bu">zip</span>(current_range, <span class="op">*</span>rows)]</span></code></pre></div></code></details>
<table>
<thead>
<tr class="header">
<th>I (A)</th>
<th>Out (kW)</th>
<th>T(overload)</th>
<th>η (%)</th>
<th>cell loss (W)</th>
<th>pack loss (W)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50.0</td>
<td>3.6</td>
<td>1.2h</td>
<td>97</td>
<td>0.55</td>
<td>10.30</td>
</tr>
<tr class="even">
<td>100.0</td>
<td>7.2</td>
<td>19min</td>
<td>95</td>
<td>2.19</td>
<td>41.19</td>
</tr>
<tr class="odd">
<td>150.0</td>
<td>10.8</td>
<td>8min</td>
<td>92</td>
<td>4.92</td>
<td>92.68</td>
</tr>
<tr class="even">
<td>200.0</td>
<td>14.4</td>
<td>5min</td>
<td>90</td>
<td>8.75</td>
<td>164.76</td>
</tr>
</tbody>
</table>
<p><u>calculate current per cell for each of those</u></p>
<details><summary> python code block</summary><code><div class="sourceCode" id="cb1" data-results="file"
data-session="battcalc" data-exports="both"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> MultipleLocator, FuncFormatter, LogLocator</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.style <span class="im">import</span> library</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(plt.rcParams.keys())</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> {</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;orange&quot;</span>: <span class="st">&quot;#ffa500&quot;</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;lightblue&quot;</span>: <span class="st">&#39;#adf7f6&#39;</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;blue&quot;</span>: <span class="st">&#39;#469ecc&#39;</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;red&quot;</span>: <span class="st">&quot;#fd5548&quot;</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;green&quot;</span>: <span class="st">&quot;#73e3bb&quot;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(library[<span class="st">&#39;dark_background&#39;</span>])</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>style <span class="op">=</span> {</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">**</span>library[<span class="st">&#39;dark_background&#39;</span>],</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Frame (spines)</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.spines.top&#39;</span>: <span class="va">True</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.spines.right&#39;</span>: <span class="va">True</span>,</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.spines.left&#39;</span>: <span class="va">True</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.spines.bottom&#39;</span>: <span class="va">True</span>,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;figure.facecolor&#39;</span>: (<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.facecolor&#39;</span>: <span class="st">&#39;#141d22&#39;</span>,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.linewidth&#39;</span>: <span class="fl">1.5</span>,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.xmargin&#39;</span>: <span class="fl">0.05</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.ymargin&#39;</span>: <span class="fl">0.05</span>,</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.zmargin&#39;</span>: <span class="fl">0.05</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># legend</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;legend.fontsize&#39;</span>: <span class="st">&#39;large&#39;</span>,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;legend.title_fontsize&#39;</span>: <span class="st">&#39;large&#39;</span>,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;legend.fancybox&#39;</span>: <span class="va">False</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;legend.edgecolor&#39;</span>: colors[<span class="st">&quot;blue&quot;</span>],</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;legend.borderaxespad&#39;</span>: <span class="fl">0.5</span>,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Grid</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.edgecolor&#39;</span>: colors[<span class="st">&quot;blue&quot;</span>],</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.labelcolor&#39;</span>: colors[<span class="st">&quot;green&quot;</span>],</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.labelsize&#39;</span>: <span class="dv">17</span>,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.grid&#39;</span>: <span class="va">True</span>,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;xtick.color&#39;</span>: colors[<span class="st">&quot;lightblue&quot;</span>],</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;ytick.color&#39;</span>: colors[<span class="st">&quot;lightblue&quot;</span>],</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.labelpad&#39;</span>: <span class="dv">10</span>,</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;xtick.major.pad&#39;</span>: <span class="dv">10</span>,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;ytick.major.pad&#39;</span>: <span class="dv">10</span>,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;grid.alpha&#39;</span>: <span class="fl">0.33</span>,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;grid.linestyle&#39;</span>: <span class="st">&#39;:&#39;</span>,</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;grid.linewidth&#39;</span>: <span class="dv">1</span>,</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;grid.color&#39;</span>: colors[<span class="st">&quot;blue&quot;</span>],</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Minor grid</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;axes.grid.which&#39;</span>: <span class="st">&#39;major&#39;</span>,  <span class="co"># &#39;major&#39;, &#39;minor&#39;, or &#39;both&#39;</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup plot style</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>plt.style.use(style)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">&#39;font.family&#39;</span>] <span class="op">=</span> <span class="st">&#39;monospace&#39;</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">&#39;font.size&#39;</span>] <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure with multiple subplots</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax3) <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">14</span>))</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Define current range (starting from small non-zero value)</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>currents <span class="op">=</span> np.linspace(<span class="dv">40</span>, <span class="dv">190</span>, <span class="dv">100</span>)</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Base substitution dictionary (everything except current and cell_ir)</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>base_subs <span class="op">=</span> {</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="op">**</span>pack_spec,</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="op">**</span>env_spec,</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">**</span>{k: v <span class="cf">for</span> k, v <span class="kw">in</span> cell_spec.items() <span class="cf">if</span> k <span class="op">!=</span> cell_ir}</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate for different internal resistances</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ir_mult <span class="kw">in</span> [<span class="fl">0.8</span>, <span class="fl">1.0</span>, <span class="fl">1.2</span>, <span class="fl">1.4</span>]:</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create substitution dictionary with current IR value</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    ir_value <span class="op">=</span> cell_spec[cell_ir] <span class="op">*</span> ir_mult</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Arrays to store results</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    pack_losses_arr <span class="op">=</span> []</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    efficiency_arr <span class="op">=</span> []</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    time_to_80deg_arr <span class="op">=</span> []</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate values for each current</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> current_val <span class="kw">in</span> currents:</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Complete substitution dictionary for this calculation</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>        subs <span class="op">=</span> {</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>            <span class="op">**</span>base_subs,</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>            current: current_val,</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>            cell_ir: ir_value</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate using SymPy expressions</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        pack_losses_val <span class="op">=</span> <span class="bu">float</span>(pack_power_loss.subs(subs))</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        efficiency_val <span class="op">=</span> <span class="bu">float</span>(efficiency.subs(subs))</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>        thermal_time_val <span class="op">=</span> <span class="bu">float</span>(thermal_time.subs(subs))</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        pack_losses_arr.append(pack_losses_val)</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        efficiency_arr.append(efficiency_val)</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>        time_to_80deg_arr.append(thermal_time_val)</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to numpy arrays</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    pack_losses_arr <span class="op">=</span> np.array(pack_losses_arr)</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    efficiency_arr <span class="op">=</span> np.array(efficiency_arr)</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    time_to_80deg_arr <span class="op">=</span> np.array(time_to_80deg_arr)</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot power losses and efficiency</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    line1 <span class="op">=</span> ax1.plot(</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        currents, </span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        pack_losses_arr,</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="ss">f&#39;</span><span class="sc">{</span>ir_value<span class="op">*</span><span class="dv">1000</span><span class="sc">:.1f}</span><span class="ss">mΩ&#39;</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    line2 <span class="op">=</span> ax2.plot(</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>        currents,</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>        efficiency_arr,</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.75</span>,</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>        linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot time to reach 80°C</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    line3 <span class="op">=</span> ax3.plot(</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>        currents,</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>        time_to_80deg_arr<span class="op">/</span><span class="dv">60</span>,  <span class="co"># Convert to minutes</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="ss">f&#39;</span><span class="sc">{</span>ir_value<span class="op">*</span><span class="dv">1000</span><span class="sc">:.1f}</span><span class="ss">mΩ&#39;</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure top plot</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">&#39;Pack Current (A)&#39;</span>)</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">&#39;Total Heat Generation (Watts)&#39;</span>)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">&#39;Pack Efficiency (%)&#39;</span>, color<span class="op">=</span>colors[<span class="st">&quot;red&quot;</span>])</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>ax1.axvline(x<span class="op">=</span><span class="dv">150</span>, color<span class="op">=</span>colors[<span class="st">&quot;red&quot;</span>], linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, label<span class="op">=</span><span class="st">&#39;Max&#39;</span>)</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>ax1.axvline(x<span class="op">=</span><span class="dv">100</span>, color<span class="op">=</span>colors[<span class="st">&quot;orange&quot;</span>], linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, label<span class="op">=</span><span class="st">&#39;High&#39;</span>)</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>ax1.axvline(x<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span>colors[<span class="st">&quot;green&quot;</span>], linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, label<span class="op">=</span><span class="st">&#39;Normal&#39;</span>)</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure bottom plot</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>ax3.set_xlabel(<span class="st">&#39;Pack Current (A)&#39;</span>)</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">&#39;Time to reach 80°C (minutes)&#39;</span>)</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>ax3.set_yscale(<span class="st">&#39;log&#39;</span>)  <span class="co"># Use log scale for time</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>ax3.yaxis.set_major_formatter(FuncFormatter(format_time))</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>ax3.yaxis.set_major_locator(LogLocator(base<span class="op">=</span><span class="fl">1.1</span>))</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Add grids</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a><span class="co">#alpha = 0.5</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.grid(True, which=&quot;major&quot;, marker=&quot;X&quot;)</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">False</span>)</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>ax2.spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>ax2.spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>ax2.spines[<span class="st">&#39;bottom&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>ax2.spines[<span class="st">&#39;left&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a><span class="co">#ax3.grid(True, which=&quot;major&quot;, ls=&quot;-&quot;)</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a><span class="co">#ax3.grid(True, which=&quot;minor&quot;, ls=&quot;:&quot;)</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>ax3.axvline(x<span class="op">=</span><span class="dv">150</span>, color<span class="op">=</span>colors[<span class="st">&quot;red&quot;</span>], linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, label<span class="op">=</span><span class="st">&#39;Max&#39;</span>)</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>ax3.axvline(x<span class="op">=</span><span class="dv">100</span>, color<span class="op">=</span>colors[<span class="st">&quot;orange&quot;</span>], linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, label<span class="op">=</span><span class="st">&#39;High&#39;</span>)</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>ax3.axvline(x<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span>colors[<span class="st">&quot;green&quot;</span>], linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, label<span class="op">=</span><span class="st">&#39;Normal&#39;</span>)</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a><span class="co"># Set axis intervals</span></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>ax1.xaxis.set_major_locator(MultipleLocator(<span class="dv">10</span>))</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>ax1.yaxis.set_major_locator(MultipleLocator(<span class="dv">200</span>))</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>ax3.xaxis.set_major_locator(MultipleLocator(<span class="dv">20</span>))</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legends</span></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a><span class="co"># legend1 = ax1.legend(title=&#39;Cell Internal Resistance&#39;, loc=&#39;upper right&#39;)</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a><span class="co"># legend3 = ax3.legend(title=&#39;Cell Internal Resistance&#39;, loc=&#39;upper right&#39;)</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a><span class="co"># frame1 = legend1.get_frame()</span></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a><span class="co"># frame3 = legend3.get_frame()</span></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a><span class="co"># frame1.set_facecolor(&#39;none&#39;)</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a><span class="co"># frame1.set_facecolor((0, 0, 0.01, 0.5))</span></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a><span class="co"># frame3.set_facecolor((0, 0, 0.01, 0.5))</span></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a><span class="co"># Save and return</span></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;./graph/battery_thermal.svg&#39;</span>, dpi<span class="op">=</span><span class="dv">150</span>, bbox_inches<span class="op">=</span><span class="st">&#39;tight&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;svg&#39;</span>, transparent<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;./graph/battery_thermal.svg&#39;</span></span></code></pre></div></code></details>
<p><img src="./graph/battery_thermal.svg" /></p>
<p>These are for static air, this seems promising given I create
airflow</p>
</section>
<section id="copper-bus-bar-and-cabling" class="level1">
<h1>Copper bus bar and cabling</h1>
<p>We need to determine optimal current density (A/mm²)</p>
<ul>
<li>Constraints here are cable temperature increase and energy loss
(W)<br />
</li>
<li>Copper resistivity at 20°C (ρ₀) = 1.68 * 10⁻⁸Ωm (or 0.0168
Ω⋅mm²/m)<br />
</li>
<li>Resistivity scales linearly with temperature ρ(T) = ρ₀[1 + α(T -
T₀)]</li>
</ul>
<p>Building a model of the wire using sympy</p>
<details><summary> python code block</summary><code><div class="sourceCode" id="cb1" data-results="none" data-exports="code"
data-session="battcalc"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy <span class="im">import</span> Symbol, solve, init_printing, expand, sqrt, pi</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy.utilities.lambdify <span class="im">import</span> lambdify</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define base physical parameters as symbols</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>length <span class="op">=</span> Symbol(<span class="st">&#39;L&#39;</span>)        <span class="co"># meters</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>area_mm2 <span class="op">=</span> Symbol(<span class="st">&#39;A&#39;</span>)      <span class="co"># mm²</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>temperature <span class="op">=</span> Symbol(<span class="st">&#39;T&#39;</span>)   <span class="co"># °C</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>current <span class="op">=</span> Symbol(<span class="st">&#39;I&#39;</span>)       <span class="co"># Amperes</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>voltage <span class="op">=</span> Symbol(<span class="st">&#39;V&#39;</span>)       <span class="co"># Volts</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>rho_0 <span class="op">=</span> Symbol(<span class="st">&#39;ρ&#39;</span>)         <span class="co"># resistivity</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> Symbol(<span class="st">&#39;α&#39;</span>)         <span class="co"># temperature coefficient</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>delta_T <span class="op">=</span> Symbol(<span class="st">&#39;ΔT&#39;</span>)      <span class="co"># temperature change</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Constants</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Copper</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>rho_copper <span class="op">=</span> <span class="fl">1.68e-8</span>     <span class="co"># Reference resistivity</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>alpha_copper <span class="op">=</span> <span class="fl">0.00393</span>   <span class="co"># Temperature coefficient</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>material_copper <span class="op">=</span> { rho_0: rho_copper, alpha: alpha_copper }</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Nickel</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>rho_nickel <span class="op">=</span> <span class="fl">6.99e-8</span>      <span class="co"># Reference resistivity</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>alpha_nickel <span class="op">=</span> <span class="fl">0.006</span>      <span class="co"># Temperature coefficient</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>material_nickel <span class="op">=</span> { rho_0: rho_nickel, alpha: alpha_nickel }</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>heat_transfer_coefficient <span class="op">=</span> <span class="dv">5</span>  <span class="co"># W/(m²·°C)</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>T_0 <span class="op">=</span> <span class="dv">20</span>                       <span class="co"># Reference temperature</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Core relationships</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>area_m2 <span class="op">=</span> area_mm2 <span class="op">*</span> <span class="fl">1e-6</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>resistivity <span class="op">=</span> rho_0 <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> alpha <span class="op">*</span> (temperature <span class="op">-</span> T_0))</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>resistance <span class="op">=</span> (resistivity <span class="op">*</span> length) <span class="op">/</span> area_m2</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>resistance_mili <span class="op">=</span> resistance <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>power_loss <span class="op">=</span> current<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> resistance</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>current_density <span class="op">=</span> current <span class="op">/</span> area_mm2</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>power <span class="op">=</span> current <span class="op">*</span> voltage</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>power_loss_percent <span class="op">=</span> (power_loss <span class="op">/</span> power) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>diameter_mm <span class="op">=</span> sqrt(area_mm2 <span class="op">/</span> pi) <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>diameter_m <span class="op">=</span> diameter_mm <span class="op">*</span> <span class="fl">1e-3</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>surface_area <span class="op">=</span> pi <span class="op">*</span> diameter_m <span class="op">*</span> length</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>delta_t <span class="op">=</span> (resistance <span class="op">*</span> current <span class="op">*</span> current) <span class="op">/</span> (surface_area <span class="op">*</span> heat_transfer_coefficient)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Running some tests</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> inspect</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(resistance.subs([(temperature, <span class="dv">30</span>), (length, <span class="dv">2</span>), (area_mm2, <span class="dv">100</span>)]))</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>resistance_fn <span class="op">=</span> lambdify([length, area_mm2, temperature], resistance)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(inspect.signature(resistance_fn))</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(resistance_fn(<span class="dv">2</span>, <span class="dv">100</span>, np.linspace(<span class="op">-</span><span class="dv">20</span>,<span class="dv">100</span>,<span class="dv">5</span>)))</span></code></pre></div></code></details>
<p>How do the power losses change with ambient temperatures and cable
cross section?</p>
<ul>
<li>temp: [-20°C, 100°C]<br />
</li>
<li>cable crosssection: [25mm², 200mm²]<br />
</li>
<li>length: 2m<br />
</li>
<li>power 12kW (where I = 150A, V = 84V)</li>
</ul>
<details><summary> python code block</summary><code><div class="sourceCode" id="cb1" data-results="file" data-exports="both"
data-session="battcalc"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Define parameter ranges</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">**</span>material_copper,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    area_mm2: np.linspace(<span class="dv">25</span>, <span class="dv">200</span>, <span class="dv">20</span>),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    current: <span class="dv">150</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    voltage: <span class="dv">84</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    length: <span class="dv">2</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure with primary and secondary y-axes</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot lines for each temperature</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> temp <span class="kw">in</span> np.linspace(<span class="op">-</span><span class="dv">20</span>, <span class="dv">100</span>, <span class="dv">4</span>):</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    loss, perc <span class="op">=</span> compute({ <span class="op">**</span>values, temperature: temp }, [ power_loss, power_loss_percent])</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    line1 <span class="op">=</span> ax1.plot(</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        values[area_mm2],</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        loss,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f&#39;</span><span class="sc">{</span>temp<span class="sc">:.0f}</span><span class="ss">°C&#39;</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    line2 <span class="op">=</span> ax2.plot(</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        values[area_mm2],</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        perc,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">&#39;orange&#39;</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure axes</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">&#39;Cable Cross-sectional Area (mm²)&#39;</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">&#39;Power Loss (Watts)&#39;</span>)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">&#39;Loss Percentage (%)&#39;</span>, color<span class="op">=</span>colors[<span class="st">&quot;red&quot;</span>])</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Add grid</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>, which<span class="op">=</span><span class="st">&quot;major&quot;</span>, ls<span class="op">=</span><span class="st">&quot;-&quot;</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>, which<span class="op">=</span><span class="st">&quot;minor&quot;</span>, ls<span class="op">=</span><span class="st">&quot;:&quot;</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">False</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>ax2.spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>ax2.spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>ax2.spines[<span class="st">&#39;bottom&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>ax2.spines[<span class="st">&#39;left&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Set axis intervals</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>ax1.xaxis.set_major_locator(MultipleLocator(<span class="dv">10</span>))</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>ax1.yaxis.set_major_locator(MultipleLocator(<span class="dv">5</span>))</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>legend <span class="op">=</span> ax1.legend(title<span class="op">=</span><span class="st">&#39;Ambient Temperature&#39;</span>, loc<span class="op">=</span><span class="st">&#39;upper right&#39;</span>)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>frame <span class="op">=</span> legend.get_frame()</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co">#frame.set_facecolor(&#39;#010101&#39;)</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Save and return</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;./graph/cable_losses.svg&#39;</span>, dpi<span class="op">=</span><span class="dv">150</span>, bbox_inches<span class="op">=</span><span class="st">&#39;tight&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;svg&#39;</span>, transparent<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;./graph/cable_losses.svg&#39;</span></span></code></pre></div></code></details>
<p><img src="./graph/cable_losses.svg" /></p>
<p>Ambient temperature doesn't seem important. We'll analize the system
at 60 degrees from now on, 2 meters length.</p>
<details><summary> python code block</summary><code><div class="sourceCode" id="cb1" data-results="table"
data-exports="both" data-session="battcalc"
data-post="header(*this*)"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">**</span>material_copper,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    current: <span class="dv">150</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    voltage: <span class="dv">84</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    temperature: <span class="dv">60</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    length: <span class="dv">2</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> round_row(<span class="op">*</span>row):</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [ <span class="ss">f&quot;</span><span class="sc">{</span>item<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> item <span class="kw">in</span> row]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> [<span class="st">&quot;mm²&quot;</span>, <span class="st">&quot;A/mm²&quot;</span>, <span class="st">&quot;diam (mm)&quot;</span>, <span class="st">&quot;Loss (W)&quot;</span>, <span class="st">&quot;Loss (%)&quot;</span>, <span class="st">&quot;ΔT (°C)&quot;</span>]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> area <span class="kw">in</span> np.linspace(<span class="dv">25</span>, <span class="dv">150</span>, <span class="dv">6</span>):</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    vals <span class="op">=</span> compute(</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        { <span class="op">**</span>values, area_mm2: area },</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        [ current_density, diameter_mm, power_loss, power_loss_percent, delta_t ])</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    rows.append(round_row(area, <span class="op">*</span>vals))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Return formatted table</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>[headers, <span class="op">*</span>rows]</span></code></pre></div></code></details>
<table>
<thead>
<tr class="header">
<th>mm²</th>
<th>A/mm²</th>
<th>diam (mm)</th>
<th>Loss (W)</th>
<th>Loss (%)</th>
<th>ΔT (°C)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>25.00</td>
<td>6.00</td>
<td>5.64</td>
<td>34.99</td>
<td>0.28</td>
<td>197.43</td>
</tr>
<tr class="even">
<td>50.00</td>
<td>3.00</td>
<td>7.98</td>
<td>17.50</td>
<td>0.14</td>
<td>69.80</td>
</tr>
<tr class="odd">
<td>75.00</td>
<td>2.00</td>
<td>9.77</td>
<td>11.66</td>
<td>0.09</td>
<td>38.00</td>
</tr>
<tr class="even">
<td>100.00</td>
<td>1.50</td>
<td>11.28</td>
<td>8.75</td>
<td>0.07</td>
<td>24.68</td>
</tr>
<tr class="odd">
<td>125.00</td>
<td>1.20</td>
<td>12.62</td>
<td>7.00</td>
<td>0.06</td>
<td>17.66</td>
</tr>
<tr class="even">
<td>150.00</td>
<td>1.00</td>
<td>13.82</td>
<td>5.83</td>
<td>0.05</td>
<td>13.43</td>
</tr>
</tbody>
</table>
<p>We are well within the safety margins.</p>
<ul>
<li>3.0A per mm² gives us 0.14% losses, wasting 17.5W<br />
</li>
<li>2.0A per mm² gives us 0.09% losses, wasting 11.5W<br />
</li>
<li>1.5A per mm² gives us 0.07% losses, wasting 8.75W<br />
</li>
<li>1.0A per mm² gives us 0.05% losses, wasting 5.8W</li>
</ul>
<p>Seems ok with 50 mm² and above, so 8mm inner cable diameter.<br />
(keep in mind 150A is 13kw so these are 0.14% losses at peaks)</p>
<p><u>goal for the rest of the system will be &gt;0.15% losses at
peaks</u></p>
</section>
<section id="aluminium-bus-bar" class="level1">
<h1>Aluminium Bus Bar</h1>
<p>Even though copper has a long history as the material of choice for
conducting electricity, aluminum has certain advantages that make it
attractive for specific applications.<br />
<a
href="https://www.anixter.com/en_us/resources/literature/wire-wisdom/copper-vs-aluminum-conductors.html">https://www.anixter.com/en_us/resources/literature/wire-wisdom/copper-vs-aluminum-conductors.html</a></p>
<p>Aluminum has 61 percent of the conductivity of copper, but has only
30 percent of the weight of copper. That means that a bare wire of
aluminum weighs half as much as a bare wire of copper that has the same
electrical resistance. Aluminum is generally more inexpensive when
compared to copper conductors.</p>
<ul>
<li>I guess depends on mechanical properties, weight, price and spot
welding</li>
</ul>
</section>
<section id="d-models" class="level1">
<h1>3D Models</h1>
<p>We define some 3d manipulation functions and test them by building a
rough cell positioning for a full pack</p>
<details><summary> clojure code block</summary><code><div class="sourceCode" id="cb1" data-exports="code" data-axes="t"
data-session="batt"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">; all our objects know their own dimensions</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">; (so that we can build auto-stacking functions)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defrecord</span><span class="fu"> Obj </span>[dims obj])</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defrecord</span><span class="fu"> NamedObj </span>[<span class="kw">name</span> dims obj])</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">; individual samsung cell dimensions</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> cellSpec </span>(<span class="kw">atom</span> { <span class="at">:r</span> <span class="fl">10.625</span> <span class="at">:height</span> <span class="fl">70.7</span> }))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>(<span class="kw">swap!</span> cellSpec <span class="kw">assoc</span> <span class="at">:d</span> (<span class="kw">*</span> (<span class="at">:r</span> <span class="at">@cellSpec</span>) <span class="dv">2</span>))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">; individual parallel group stacking settings (8P)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> cellGroupSpec </span>(<span class="kw">atom</span> { <span class="at">:xn</span> <span class="dv">3</span> <span class="at">:yn</span> <span class="dv">3</span> <span class="at">:space</span> <span class="dv">5</span> }))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">; full battery pack stacking settings (20S8P)</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> packSpec </span>(<span class="kw">atom</span> { <span class="at">:xn</span> <span class="dv">4</span> <span class="at">:yn</span> <span class="dv">5</span> <span class="at">:space</span> <span class="dv">20</span> }))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> cellObj</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [r (<span class="at">:r</span> <span class="at">@cellSpec</span>) d (<span class="kw">*</span> r <span class="dv">2</span>) height (<span class="at">:height</span> <span class="at">@cellSpec</span>) green [<span class="fl">0.6</span> <span class="dv">1</span> <span class="fl">0.6</span> <span class="fl">0.5</span>]]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    (-&gt;Obj [ d d height ]</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">union</span> (color green (cylinder r, height)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        (translate [<span class="dv">0</span>, <span class="dv">0</span>, (<span class="kw">+</span> (<span class="kw">/</span> height <span class="dv">2</span>) <span class="dv">1</span>)] (cylinder <span class="dv">5</span> <span class="dv">2</span>)))))))</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">; basic ops so we don&#39;t need to destructure our Obj record</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> swap-dims-90 </span>[dims axis]</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [[x y z] dims]</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">case</span> axis</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">:x</span> [x z y]    <span class="co">; y-&gt;z, z-&gt;y</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">:y</span> [z y x]    <span class="co">; x-&gt;z, z-&gt;x</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">:z</span> [y x z]))) <span class="co">; x-&gt;y, y-&gt;x</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> swap-dims </span>[dims axis rotations]</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">nth</span> (<span class="kw">iterate</span> #(swap-dims<span class="dv">-90</span> <span class="va">%</span> axis) dims)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>       (<span class="kw">mod</span> rotations <span class="dv">4</span>)))</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> rotateObj </span>[dirs obj]</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [[rx ry rz] dirs</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        angle-x (<span class="kw">*</span> (<span class="kw">mod</span> rx <span class="dv">4</span>) (<span class="kw">/</span> Math/PI <span class="dv">2</span>))</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        angle-y (<span class="kw">*</span> (<span class="kw">mod</span> ry <span class="dv">4</span>) (<span class="kw">/</span> Math/PI <span class="dv">2</span>))</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        angle-z (<span class="kw">*</span> (<span class="kw">mod</span> rz <span class="dv">4</span>) (<span class="kw">/</span> Math/PI <span class="dv">2</span>))</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        new-dims (<span class="kw">-&gt;</span> (<span class="at">:dims</span> obj)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                    (swap-dims <span class="at">:x</span> rx)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>                    (swap-dims <span class="at">:y</span> ry)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                    (swap-dims <span class="at">:z</span> rz))]</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    (-&gt;Obj new-dims </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>           (rotate [angle-x angle-y angle-z] (<span class="at">:obj</span> obj)))))</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> flipObj </span>[obj] (rotateObj [<span class="dv">2</span> <span class="dv">0</span> <span class="dv">0</span>] obj))</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> translateObj </span>[<span class="kw">vector</span> obj] (-&gt;Obj (<span class="at">:dims</span> obj) (translate <span class="kw">vector</span> (<span class="at">:obj</span> obj))))</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> colorObj </span>[newcolor obj] (-&gt;Obj (<span class="at">:dims</span> obj) (color newcolor (<span class="at">:obj</span> obj))))</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> overrideDims </span>[dimsObj targetObj] (-&gt;Obj (<span class="at">:dims</span> dimsObj) (<span class="at">:obj</span> targetObj)))</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> unionObj </span>[objs]</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  (-&gt;Obj (<span class="at">:dims</span> (<span class="kw">first</span> objs))</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>         (<span class="kw">apply</span> <span class="kw">union</span> (<span class="kw">map</span> <span class="at">:obj</span> objs))))</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="co">; main object stacking function</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> pairObj </span>[dimension distance obj1 obj2]</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="co">;(println &quot;// Input objects dims:&quot; (:dims obj1) (:dims obj2))</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  <span class="co">; First calculate total dims</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [distance-vec (<span class="kw">mapv</span> #(<span class="kw">if</span> (<span class="kw">zero?</span> <span class="va">%</span>) <span class="dv">0</span> (<span class="kw">*</span> <span class="va">%</span> distance)) dimension)</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        total-dims (<span class="kw">mapv</span> <span class="kw">+</span> </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>                        (<span class="kw">mapv</span> <span class="kw">*</span> dimension (<span class="at">:dims</span> obj1))</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>                        (<span class="kw">mapv</span> <span class="kw">*</span> dimension (<span class="at">:dims</span> obj2))</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>                        distance-vec</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>                        (<span class="kw">mapv</span> <span class="kw">*</span> (<span class="kw">mapv</span> #(<span class="kw">-</span> <span class="dv">1</span> <span class="va">%</span>) dimension)</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>                              (<span class="kw">mapv</span> <span class="kw">max</span> (<span class="at">:dims</span> obj1) (<span class="at">:dims</span> obj2))))</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        <span class="co">;_ (println &quot;// total-dims:&quot; total-dims)</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        <span class="co">; Get the joining dimension index (0 for x, 1 for y, 2 for z)</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        join-dim (<span class="kw">first</span> (keep-indexed #(<span class="kw">when</span> (<span class="kw">=</span> <span class="va">%2</span> <span class="dv">1</span>) <span class="va">%1</span>) dimension))</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">; Get sizes in joining dimension</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>        total-size (<span class="kw">nth</span> total-dims join-dim)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>        obj1-size (<span class="kw">nth</span> (<span class="at">:dims</span> obj1) join-dim)</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>        obj2-size (<span class="kw">nth</span> (<span class="at">:dims</span> obj2) join-dim)</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>        <span class="co">; Calculate offsets in joining dimension</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>        obj1-offset (<span class="kw">mapv</span> #(<span class="kw">if</span> (<span class="kw">=</span> <span class="va">%</span> <span class="dv">1</span>) (<span class="kw">/</span> (<span class="kw">-</span> total-size obj1-size) <span class="dv">2</span>) <span class="dv">0</span>) dimension)</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>        obj2-offset (<span class="kw">mapv</span> #(<span class="kw">if</span> (<span class="kw">=</span> <span class="va">%</span> <span class="dv">1</span>) (<span class="kw">/</span> (<span class="kw">-</span> total-size obj2-size) -<span class="dv">2</span>) <span class="dv">0</span>) dimension)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>        <span class="co">;_ (println &quot;// obj1 translation:&quot; (mapv - obj1-offset))</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>        <span class="co">;_ (println &quot;// obj2 translation:&quot; (mapv - obj2-offset))</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>        obj1-trans (translate (<span class="kw">mapv</span> <span class="kw">-</span> obj1-offset) (<span class="at">:obj</span> obj1))</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>        obj2-trans (translate (<span class="kw">mapv</span> <span class="kw">-</span> obj2-offset) (<span class="at">:obj</span> obj2))]</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    (-&gt;Obj total-dims (<span class="kw">union</span> obj1-trans obj2-trans))))</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="co">; like pairObj but it slaps on obj2 without changing Obj record dimensions or position</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> slapObj </span>[dimension distance obj1 obj2]</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [distance-vec (<span class="kw">mapv</span> #(<span class="kw">if</span> (<span class="kw">zero?</span> <span class="va">%</span>) <span class="dv">0</span> (<span class="kw">*</span> <span class="va">%</span> distance)) dimension)</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>        total-dims (<span class="kw">mapv</span> <span class="kw">+</span> </span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>                        (<span class="kw">mapv</span> <span class="kw">*</span> dimension (<span class="at">:dims</span> obj1))</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>                        (<span class="kw">mapv</span> <span class="kw">*</span> dimension (<span class="at">:dims</span> obj2))</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>                        distance-vec</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>                        (<span class="kw">mapv</span> <span class="kw">*</span> (<span class="kw">mapv</span> #(<span class="kw">-</span> <span class="dv">1</span> <span class="va">%</span>) dimension)</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>                              (<span class="kw">mapv</span> <span class="kw">max</span> (<span class="at">:dims</span> obj1) (<span class="at">:dims</span> obj2))))</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        <span class="co">;_ (println &quot;// total-dims:&quot; total-dims)</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        <span class="co">; Get the joining dimension index (0 for x, 1 for y, 2 for z)</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>        join-dim (<span class="kw">first</span> (keep-indexed #(<span class="kw">when</span> (<span class="kw">=</span> <span class="va">%2</span> <span class="dv">1</span>) <span class="va">%1</span>) dimension))</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        <span class="co">; Get sizes in joining dimension</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        total-size (<span class="kw">nth</span> total-dims join-dim)</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>        obj1-size (<span class="kw">nth</span> (<span class="at">:dims</span> obj1) join-dim)</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>        obj2-size (<span class="kw">nth</span> (<span class="at">:dims</span> obj2) join-dim)</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>        <span class="co">; Calculate offsets in joining dimension</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>        obj1-offset (<span class="kw">mapv</span> #(<span class="kw">if</span> (<span class="kw">=</span> <span class="va">%</span> <span class="dv">1</span>) (<span class="kw">/</span> (<span class="kw">-</span> total-size obj1-size) <span class="dv">2</span>) <span class="dv">0</span>) dimension)</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>        obj2-offset (<span class="kw">mapv</span> #(<span class="kw">if</span> (<span class="kw">=</span> <span class="va">%</span> <span class="dv">1</span>) (<span class="kw">/</span> (<span class="kw">-</span> total-size obj2-size) -<span class="dv">2</span>) <span class="dv">0</span>) dimension)</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>        <span class="co">;_ (println &quot;// obj1 translation:&quot; (mapv - obj1-offset))</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        <span class="co">;_ (println &quot;// obj2 translation:&quot; (mapv - obj2-offset))</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        obj1-trans (translate (<span class="kw">mapv</span> <span class="kw">-</span> obj1-offset) (<span class="at">:obj</span> obj1))</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>        obj2-trans (translate (<span class="kw">mapv</span> <span class="kw">-</span> obj2-offset) (<span class="at">:obj</span> obj2))]</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>    (-&gt;Obj total-dims (<span class="kw">union</span> obj1-trans obj2-trans))))</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a><span class="co">; table print helpers</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> printDimsHeader </span>[]</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">println</span> <span class="st">&quot;| Name | dimX (mm) | dimY (mm) | dimZ (mm) | Vol (cm3) |&quot;</span>)</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">println</span> <span class="st">&quot;|-&quot;</span>))</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> printDim </span>[<span class="kw">name</span> obj]</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>        volume (<span class="kw">/</span> (<span class="kw">reduce</span> <span class="kw">*</span> (<span class="at">:dims</span> obj)) <span class="dv">1000</span>)</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>        row (<span class="kw">vec</span> (<span class="kw">concat</span> [<span class="kw">name</span>] (<span class="at">:dims</span> obj) [volume]))</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">println</span> <span class="st">&quot;|&quot;</span> (<span class="kw">apply</span> <span class="kw">str</span> (<span class="kw">interpose</span> <span class="st">&quot;|&quot;</span> row )))))</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> printDims </span>[&amp; args]</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>  (printDimsHeader)</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">doseq</span> [[<span class="kw">name</span> obj] (<span class="kw">partition</span> <span class="dv">2</span> args)]</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    (printDim <span class="kw">name</span> obj)))</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a><span class="co">; color helpers</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> hex-to-rgb</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Convert a hex color string (e.g., </span><span class="sc">\&quot;</span><span class="st">#adf7f6</span><span class="sc">\&quot;</span><span class="st">) to a normalized RGB vector [r g b]</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a><span class="st">   where each component is normalized to [0, 1]&quot;</span></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>  [hex-str]</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [hex (<span class="kw">if</span> (<span class="kw">=</span> (<span class="kw">first</span> hex-str) <span class="at">\#</span>)</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>              (<span class="kw">subs</span> hex-str <span class="dv">1</span>)</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>              hex-str)</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>        rgb-int (Integer/parseInt hex <span class="dv">16</span>)</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>        r (<span class="kw">bit-shift-right</span> (<span class="kw">bit-and</span> rgb-int <span class="bn">0xFF0000</span>) <span class="dv">16</span>)</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>        g (<span class="kw">bit-shift-right</span> (<span class="kw">bit-and</span> rgb-int <span class="bn">0x00FF00</span>) <span class="dv">8</span>)</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>        b (<span class="kw">bit-and</span> rgb-int <span class="bn">0x0000FF</span>)]</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    [(<span class="kw">/</span> r <span class="fl">255.0</span>) (<span class="kw">/</span> g <span class="fl">255.0</span>) (<span class="kw">/</span> b <span class="fl">255.0</span>)]))</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> red </span>(hex-to-rgb <span class="st">&quot;#fd5548&quot;</span>))</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> green </span>(hex-to-rgb <span class="st">&quot;#73e3bb&quot;</span>))</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> blue </span>(hex-to-rgb <span class="st">&quot;#469ecc&quot;</span>))</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> lightblue </span>(hex-to-rgb <span class="st">&quot;#adf7f6&quot;</span>))</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> orangeblue </span>(hex-to-rgb <span class="st">&quot;#ffa500&quot;</span>))</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a><span class="co">;(def testObj1 (-&gt;Obj [25 25 25] (color [1 0 0] (cube 25 25 25))))</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a><span class="co">;(def testObj2 (-&gt;Obj [10 10 10] (color [0 1 0] (cube 10 10 10))))</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a><span class="co">;(:obj (pairObj [0 0 1] 10 testObj1 testObj2))</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a><span class="co">;(defn objF [] testObj2)</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a><span class="co">;(:obj (seqObj [0 0 1] 10 [testObj2 testObj1 testObj2]))</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> seqObj </span>[dimension distance objs]</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">reduce</span> (<span class="kw">fn</span> [acc obj] (pairObj dimension distance acc obj)) (<span class="kw">first</span> objs) (<span class="kw">rest</span> objs)))</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> previewObj </span>[distance obj]</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [rot (<span class="kw">/</span> Math/PI <span class="dv">4</span>)]</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>          (<span class="at">:obj</span> (unionObj [</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>           (translateObj [distance <span class="dv">0</span> distance] obj)</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>           (translateObj [(<span class="kw">*</span> distance <span class="dv">1</span>) <span class="dv">0</span> (<span class="kw">*</span> distance -<span class="dv">1</span>)] (rotateObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>] obj))</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>           (translateObj [(<span class="kw">*</span> distance -<span class="dv">1</span>) <span class="dv">0</span> (<span class="kw">*</span> distance -<span class="dv">1</span>)] (rotateObj [<span class="dv">3</span> <span class="dv">0</span> <span class="dv">1</span>] obj))</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>           (translateObj [(<span class="kw">*</span> distance -<span class="dv">1</span>) <span class="dv">0</span> (<span class="kw">*</span> distance <span class="dv">1</span>)]</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>                         (-&gt;Obj (<span class="at">:dims</span> obj) (rotate [rot <span class="dv">0</span> <span class="dv">0</span>] (rotate [<span class="dv">0</span> <span class="dv">0</span> rot] (<span class="at">:obj</span> obj)))))</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>]))))</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> repeatObj </span>[dimension distance n obj] (seqObj dimension distance (<span class="kw">repeat</span> n obj)))</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> xyGrid </span>[dist xn yn obj]</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>    (seqObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>] dist</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">repeat</span> xn (seqObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] dist (<span class="kw">repeat</span> yn obj)))))</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> parallelCellsObj </span>(xyGrid (<span class="at">:space</span> <span class="at">@cellGroupSpec</span>) (<span class="at">:xn</span> <span class="at">@cellGroupSpec</span>) (<span class="at">:yn</span> <span class="at">@cellGroupSpec</span>) cellObj))</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> packObj </span>(xyGrid (<span class="at">:space</span> <span class="at">@packSpec</span>) (<span class="at">:xn</span> <span class="at">@packSpec</span>) (<span class="at">:yn</span> <span class="at">@packSpec</span>) parallelCellsObj))</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a></span></code></pre></div></code></details>
<p>Investigating different pack formats</p>
<details><summary> clojure code block</summary><code><div class="sourceCode" id="cb1" data-exports="both" data-axes="t"
data-session="batt" data-codefile="code.clj"
data-scadfile="code.scad"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> rotCellObj </span>(rotateObj [ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> ] parallelCellsObj))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack1 </span>(rotateObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] packObj))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">; (println &quot;// pack1 dimensions: &quot; (:dims pack1))</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack2</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">; (repeatObj [1 0 0] 20 2</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a> (rotateObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">1</span>] (repeatObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>] <span class="dv">20</span> <span class="dv">4</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a> (rotateObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] (repeatObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] <span class="dv">5</span> <span class="dv">5</span> rotCellObj)))))<span class="co">;)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">;(println &quot;// pack2 dimensions: &quot; (:dims  (rotateObj [1 0 0] pack2)))</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack3</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">; (repeatObj [1 0 0] 20 2</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a> (rotateObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>]</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            (repeatObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>] <span class="dv">20</span> <span class="dv">5</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a> (rotateObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span>] (repeatObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] <span class="dv">5</span> <span class="dv">4</span> rotCellObj)))))<span class="co">;)</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">; (println &quot;// pack3 dimensions: &quot; (:dims  (rotateObj [1 0 0] pack3)))</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack4</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  (repeatObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] <span class="dv">20</span> <span class="dv">2</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  (repeatObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>] <span class="dv">20</span> <span class="dv">2</span> </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  (repeatObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] <span class="dv">20</span> <span class="dv">5</span> parallelCellsObj))))</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">; (println &quot;// pack4 dimensions: &quot; (:dims pack3))</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> frame </span>[x y z thicc]</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  (-&gt;Obj [x y thicc]</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [x2 (<span class="kw">/</span> x -<span class="dv">2</span>)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        y2 (<span class="kw">/</span> y <span class="dv">2</span>)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        z2 (<span class="kw">/</span> z <span class="dv">2</span>)]</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">union</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>     (translate [<span class="dv">0</span> y2 z2] (cube x thicc z))</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>     (translate [x2 <span class="dv">0</span> z2] (cube thicc y z))</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>     (cube x y thicc))</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>)))</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> battCase </span>(colorObj [<span class="fl">0.25</span> <span class="fl">0.25</span> <span class="fl">0.25</span> <span class="fl">0.5</span>] (frame <span class="dv">350</span> <span class="dv">500</span> <span class="dv">195</span> <span class="dv">3</span>)))</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>(previewObj <span class="dv">300</span> (slapObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] <span class="dv">0</span> battCase pack1))</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>(<span class="at">:obj</span> (seqObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>] <span class="dv">100</span> [pack1 pack2 pack3 pack4 ]))</span></code></pre></div></code></details>
<div class="RESULTS drawer">
<p><img src="././3d/packs2.jpg" /></p>
</div>
<code><div class="sourceCode" id="cb1" data-exports="both" data-session="batt"
data-codefile="code.clj" data-results="output table"
data-scadfile="code.scad"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(printDims <span class="st">&quot;bc&quot;</span> battCase <span class="st">&quot;p1&quot;</span> pack1 <span class="st">&quot;p2&quot;</span> pack2 <span class="st">&quot;p3&quot;</span> pack3 <span class="st">&quot;p4&quot;</span> pack4)</span></code></pre></div></code>
<div class="RESULTS drawer">
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>dimX (mm)</th>
<th>dimY (mm)</th>
<th>dimZ (mm)</th>
<th>Vol (cm3)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>bc</td>
<td>350</td>
<td>500</td>
<td>3</td>
<td>525</td>
</tr>
<tr class="even">
<td>p1</td>
<td>317.5</td>
<td>460.0</td>
<td>70.7</td>
<td>10325.735</td>
</tr>
<tr class="odd">
<td>p2</td>
<td>373.5</td>
<td>460.0</td>
<td>47.5</td>
<td>8160.975</td>
</tr>
<tr class="even">
<td>p3</td>
<td>250.0</td>
<td>373.5</td>
<td>100.0</td>
<td>9337.5</td>
</tr>
<tr class="odd">
<td>p4</td>
<td>220.0</td>
<td>317.5</td>
<td>161.4</td>
<td>11273.79</td>
</tr>
</tbody>
</table>
</div>
<p>actually pack2/3 seem very interesting, why is this an uncommon
format for high output batteries?</p>
</section>
<section id="pack-1-option" class="level1">
<h1>Pack 1 Option</h1>
<section id="model" class="level2">
<h2>Model</h2>
<code><div class="sourceCode" id="cb1" data-exports="both" data-axes="t"
data-session="batt" data-codefile="code.clj"
data-scadfile="code.scad"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(previewObj <span class="dv">300</span> pack1)</span></code></pre></div></code>
<div class="RESULTS drawer">
<p><img src="././3d/pack1.jpg" /></p>
</div>
<code><div class="sourceCode" id="cb1" data-exports="both" data-axes="t"
data-session="batt" data-codefile="code.clj"
data-scadfile="code.scad"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">:obj</span> (slapObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] <span class="dv">0</span> battCase pack1))</span></code></pre></div></code>
<div class="RESULTS drawer">
<p><img src="././3d/pack1_full.jpg" /></p>
</div>
</section>
<section id="details" class="level2">
<h2>Details</h2>
<code><div class="sourceCode" id="cb1" data-exports="both" data-session="batt"
data-codefile="code.clj" data-results="output table"
data-scadfile="code.scad"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(printDims <span class="st">&quot;bc&quot;</span> battCase <span class="st">&quot;p1&quot;</span> pack1)</span></code></pre></div></code>
<div class="RESULTS drawer">
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>dimX (mm)</th>
<th>dimY (mm)</th>
<th>dimZ (mm)</th>
<th>Vol (cm3)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>bc</td>
<td>350</td>
<td>500</td>
<td>3</td>
<td>525</td>
</tr>
<tr class="even">
<td>p1</td>
<td>317.5</td>
<td>460.0</td>
<td>70.7</td>
<td>10325.735</td>
</tr>
</tbody>
</table>
</div>
<section id="thermals" class="level3">
<h3>Thermals</h3>
<ul>
<li>Probably speed controlled server rack fans<br />
</li>
<li>just leave space for fans for now, see thermal perforamnce
later<br />
</li>
<li>probably need some airflow though, figure out how to deal with water
ingress etc</li>
</ul>
</section>
<section id="fusing" class="level3">
<h3>Fusing</h3>
<ul>
<li>hopefully appropriate Nikel width can be decided upon, I assume
nickel is not the best fusing material but will work.</li>
</ul>
</section>
</section>
<section id="bus-bar-1-design" class="level2">
<h2>Bus Bar 1 Design</h2>
<details><summary> clojure code block</summary><code><div class="sourceCode" id="cb1" data-exports="both" data-axes="t"
data-session="batt" data-codefile="code.clj"
data-scadfile="code.scad"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">; specification for the bus bar construction</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> busBarSpec </span>(<span class="kw">atom</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>   {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">:thicc</span> <span class="dv">3</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">:holespace</span> <span class="dv">2</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">:padding</span> <span class="dv">10</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">:zOffset</span> <span class="dv">0</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>(<span class="kw">let</span> [r (<span class="kw">+</span> (<span class="at">:r</span> <span class="at">@cellSpec</span>) (<span class="at">:holespace</span> <span class="at">@busBarSpec</span>)) d (<span class="kw">*</span> r <span class="dv">2</span>) thicc ( <span class="kw">+</span> (<span class="at">:thicc</span> <span class="at">@busBarSpec</span>) <span class="dv">1</span>)]</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a> (<span class="bu">def</span><span class="fu"> cellHoleObj</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>   (-&gt;Obj [ (<span class="at">:d</span> <span class="at">@cellSpec</span>) (<span class="at">:d</span> <span class="at">@cellSpec</span>) thicc ] (cylinder r, thicc))))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> holeGroupObj </span>(xyGrid (<span class="at">:space</span> <span class="at">@cellGroupSpec</span>) (<span class="at">:xn</span> <span class="at">@cellGroupSpec</span>) (<span class="at">:yn</span> <span class="at">@cellGroupSpec</span>) cellHoleObj))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>(<span class="kw">let</span> [parallelCellsDim (<span class="at">:dims</span> parallelCellsObj)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      padding     (<span class="kw">+</span> (<span class="at">:padding</span> <span class="at">@busBarSpec</span>) (<span class="at">:holespace</span> <span class="at">@busBarSpec</span>))</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      thicc       (<span class="at">:thicc</span> <span class="at">@busBarSpec</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      zOffset     (<span class="at">:zOffset</span> <span class="at">@busBarSpec</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>      cellHeight  (<span class="kw">get</span> parallelCellsDim <span class="dv">2</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>      xDim        (<span class="kw">+</span> (<span class="kw">get</span> parallelCellsDim <span class="dv">0</span>) padding)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>      yDim        (<span class="kw">+</span> (<span class="kw">get</span> parallelCellsDim <span class="dv">1</span>) padding)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="co">; copperColor [0.9 0.55 0.3]]</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      copperColor (hex-to-rgb <span class="st">&quot;#ffa500&quot;</span>)]</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">println</span> <span class="st">&quot;// dims&quot;</span> xDim yDim thicc)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> busBarObj</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  (-&gt;Obj [xDim yDim thicc]</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>         (color copperColor (translate [<span class="dv">0</span> <span class="dv">0</span> (<span class="kw">+</span> zOffset)]</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>         (<span class="kw">difference</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>           (cube xDim yDim thicc)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>           (<span class="at">:obj</span> holeGroupObj))))))</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co">;(def parallelCellsObj (xyGrid (:space @cellGroupSpec) (:xn @cellGroupSpec) (:yn @cellGroupSpec) cellObj))</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> nickelStripObj</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>      nickelWidth   <span class="dv">8</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>      nickelLength  xDim</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>      nickelThicc   <span class="dv">1</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>      nickelColor   [<span class="fl">0.7</span> <span class="fl">0.7</span> <span class="fl">0.7</span>]</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>                           <span class="co">; &quot;virtual&quot; Y thickness for easy assembly</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>      (-&gt;Obj [nickelLength (<span class="at">:d</span> <span class="at">@cellSpec</span>) nickelThicc]</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>             (color nickelColor (cube nickelLength nickelWidth nickelThicc)))))</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> nickelStripSpacerObj</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>      nickelWidth   <span class="dv">8</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>      nickelLength (<span class="kw">-</span> (<span class="at">:space</span> <span class="at">@packSpec</span>) padding)   </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>      nickelThicc   <span class="dv">1</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>      nickelColor   [<span class="fl">0.7</span> <span class="fl">0.7</span> <span class="fl">0.7</span>]</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>                           <span class="co">; &quot;virtual&quot; Y thickness for easy assembly</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>      (-&gt;Obj [nickelLength (<span class="at">:d</span> <span class="at">@cellSpec</span>) nickelThicc]</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>             (color nickelColor (cube nickelLength nickelWidth nickelThicc)))))</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> nickelStripsObj </span>(pairObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@cellGroupSpec</span>) nickelStripObj nickelStripObj))</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> nickelStripsSpacerObj </span>(pairObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@cellGroupSpec</span>) nickelStripSpacerObj nickelStripSpacerObj))</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> busBarNickelObj </span>(pairObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] <span class="dv">0</span> busBarObj nickelStripsObj ))</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> busBarPairX</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        midSpace (<span class="kw">-</span> (<span class="at">:space</span> <span class="at">@packSpec</span>) padding)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>        width (<span class="kw">nth</span> (<span class="at">:dims</span> busBarObj) <span class="dv">1</span>)</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        spacer (-&gt;Obj [midSpace width thicc] (color copperColor (cube midSpace width thicc)))</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        joinedBusBar (seqObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>] <span class="dv">0</span> [busBarObj spacer busBarObj])</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>        joinedNickelStrips (seqObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>] <span class="dv">0</span> [nickelStripsObj nickelStripsSpacerObj nickelStripsObj])</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="co">;joinedNickelStrips</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    (pairObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] <span class="dv">0</span> joinedBusBar joinedNickelStrips)</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> test2SX </span>(pairObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) parallelCellsObj (flipObj parallelCellsObj)))</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> testBusBars2SX </span>(pairObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] <span class="fl">0.1</span> test2SX busBarPairX))</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> busBarPairY</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>        midSpace (<span class="kw">-</span> (<span class="at">:space</span> <span class="at">@packSpec</span>) padding)</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>        width (<span class="kw">nth</span> (<span class="at">:dims</span> busBarObj) <span class="dv">0</span>)</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>        spacer (-&gt;Obj [width midSpace thicc] (color copperColor (cube width midSpace thicc)))</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>        joinedBusBar (seqObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] <span class="dv">0</span> [busBarObj spacer busBarObj])</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>        joinedNickelStrips (pairObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) nickelStripsObj nickelStripsObj)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    (pairObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] <span class="dv">0</span> joinedBusBar joinedNickelStrips)))</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> test2S </span>(pairObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) parallelCellsObj (flipObj parallelCellsObj)))</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> testBusBars2S </span>(pairObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] <span class="fl">0.1</span> test2S busBarPairY))</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a><span class="co">;(:obj testBusBars2S)</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>(<span class="kw">let</span> [</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>      thicc (<span class="kw">nth</span> (<span class="at">:dims</span> busBarPairY) <span class="dv">2</span>)</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>      moveZ (<span class="kw">+</span> <span class="fl">0.1</span> (<span class="kw">/</span> (<span class="kw">nth</span> (<span class="at">:dims</span> parallelCellsObj) <span class="dv">2</span>) <span class="dv">2</span>))</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack1STermObj</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>   (-&gt;Obj (<span class="at">:dims</span> parallelCellsObj)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>          (<span class="kw">union</span> (<span class="at">:obj</span> parallelCellsObj) (translate [<span class="dv">0</span> <span class="dv">0</span> moveZ] (<span class="at">:obj</span> busBarNickelObj))))))</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>(<span class="kw">let</span> [</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>      thicc (<span class="kw">nth</span> (<span class="at">:dims</span> busBarPairY) <span class="dv">2</span>)</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>      moveZ (<span class="kw">+</span> <span class="fl">0.1</span> (<span class="kw">/</span> (<span class="kw">nth</span> (<span class="at">:dims</span> parallelCellsObj) <span class="dv">2</span>) <span class="dv">2</span>))</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>      moveY (<span class="kw">/</span> (<span class="kw">+</span> (<span class="kw">nth</span> (<span class="at">:dims</span> parallelCellsObj) <span class="dv">1</span>) (<span class="at">:space</span> <span class="at">@packSpec</span>)) <span class="dv">2</span>)</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack1SYObjTerm</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>   (-&gt;Obj (<span class="at">:dims</span> parallelCellsObj)</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>          (<span class="kw">union</span> (<span class="at">:obj</span> parallelCellsObj)</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>                 (translate [<span class="dv">0</span> moveY moveZ] (<span class="at">:obj</span> busBarPairY))</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>                 (translate [<span class="dv">0</span> <span class="dv">0</span> (<span class="kw">*</span> moveZ -<span class="dv">1</span>)] (<span class="at">:obj</span> (flipObj busBarNickelObj)))</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>                 ))))</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>(<span class="kw">let</span> [</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>      thicc (<span class="kw">nth</span> (<span class="at">:dims</span> busBarPairY) <span class="dv">2</span>)</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>      moveZ (<span class="kw">+</span> <span class="fl">0.1</span> (<span class="kw">/</span> (<span class="kw">nth</span> (<span class="at">:dims</span> parallelCellsObj) <span class="dv">2</span>) <span class="dv">2</span>))</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>      moveY (<span class="kw">/</span> (<span class="kw">+</span> (<span class="kw">nth</span> (<span class="at">:dims</span> parallelCellsObj) <span class="dv">1</span>) (<span class="at">:space</span> <span class="at">@packSpec</span>)) <span class="dv">2</span>)</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack1SYObj</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>   (-&gt;Obj (<span class="at">:dims</span> parallelCellsObj)</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>          (<span class="kw">union</span> (<span class="at">:obj</span> parallelCellsObj) (translate [<span class="dv">0</span> moveY moveZ] (<span class="at">:obj</span> busBarPairY))))))</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack1SObj </span>parallelCellsObj)</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>(<span class="kw">let</span> [</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>      thicc (<span class="kw">nth</span> (<span class="at">:dims</span> busBarPairY) <span class="dv">2</span>)</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>      moveZ (<span class="kw">+</span> <span class="fl">0.1</span> (<span class="kw">/</span> (<span class="kw">nth</span> (<span class="at">:dims</span> parallelCellsObj) <span class="dv">2</span>) <span class="dv">2</span>))</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>      moveX (<span class="kw">/</span> (<span class="kw">+</span> (<span class="kw">nth</span> (<span class="at">:dims</span> parallelCellsObj) <span class="dv">0</span>) (<span class="at">:space</span> <span class="at">@packSpec</span>)) <span class="dv">2</span>)</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack1SXObj</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>   (-&gt;Obj (<span class="at">:dims</span> parallelCellsObj)</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>          (<span class="kw">union</span> (<span class="at">:obj</span> parallelCellsObj) (translate [moveX <span class="dv">0</span> moveZ] (<span class="at">:obj</span> busBarPairX))))))</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack1SPreview </span>(pairObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) pack1SYObj (rotateObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">2</span>] parallelCellsObj) ))</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack2SObj </span>(pairObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) pack1SYObj (rotateObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">2</span>] (flipObj pack1SYObj)) ))</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack2SObjTerm </span>(pairObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) pack1SYObjTerm (rotateObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">2</span>] (flipObj pack1SYObj)) ))</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack4SObjTerm </span>(pairObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) pack2SObjTerm pack2SObj))</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack4SObj </span>(pairObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) pack2SObj pack2SObj))</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack5SObj </span>(pairObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) pack4SObj pack1SXObj))</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack5SObjTermLast </span>(pairObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) pack4SObjTerm pack1SObj))</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack5SObjTerm </span>(pairObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) pack4SObjTerm pack1SXObj))</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack10SObj </span>(pairObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) pack5SObj (rotateObj [<span class="dv">0</span> <span class="dv">2</span> <span class="dv">2</span>] pack5SObj)))</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack20SObj </span>(seqObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>)</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>   [</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>    pack5SObjTerm</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    (flipObj pack5SObj) pack5SObj</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    pack5SObjTermLast</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>  ]))</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack5SObjPlain</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>  (seqObj [<span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) [pack1STermObj pack1STermObj pack1STermObj pack1STermObj pack1STermObj]))</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> pack20SObjPlain</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>  (seqObj [<span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span>] (<span class="at">:space</span> <span class="at">@packSpec</span>) [pack5SObjPlain pack5SObjPlain pack5SObjPlain pack5SObjPlain]))</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a><span class="co">;(:obj (rotateObj [0 2 0] pack20SObj))</span></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a><span class="co">;(:obj pack20SObj)</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>(<span class="at">:obj</span> (slapObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] <span class="dv">0</span> battCase (rotateObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] pack20SObj)))</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a><span class="co">;(:obj testBusBars2SX)</span></span></code></pre></div></code></details>
<div class="RESULTS drawer">
<p><img src="././3d/horizBusPack.jpg" /></p>
</div>
<code><div class="sourceCode" id="cb1" data-exports="both" data-axes="t"
data-session="batt" data-codefile="code.clj"
data-scadfile="code.scad"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(previewObj <span class="dv">100</span> testBusBars2S)</span></code></pre></div></code>
<div class="RESULTS drawer">
<p><img src="././3d/horizBus2S.jpg" /></p>
</div>
</section>
<section id="bus-bar-system-1-notes" class="level2">
<h2>Bus Bar System 1 Notes</h2>
<ul>
<li>2 types, X and Y<br />
</li>
<li>spot welded to nickel strip<br />
</li>
<li>this design seems a bit problemtic since neighbouring plates can
easily short<br />
</li>
<li>needs plastic isolation on sides of bus bar to prevent shorts<br />
</li>
<li>probably battery is in a sandwich of plexyglass</li>
</ul>
<p>likely plastic insulation between bus bars can double as a structural
frame?</p>
<section id="review" class="level3">
<h3>Review</h3>
<ul>
<li>P-groups are not all the same<br />
</li>
<li>Structural issues during construction, requires access to top and
bottom of P-Groups yet they are not structurally sound without sandwich
panels which obstruct access<br />
</li>
<li>Difficult battery deconstruction<br />
</li>
<li>Fuses need to connect to bus bar only on one contact point</li>
</ul>
</section>
<section id="conclusions" class="level3">
<h3>Conclusions</h3>
<ul>
<li>Redesign this with bus bars (and balancing leads, fuses) that are
embedded into the top/bottom sandwich panels, thus keeping the P-groups
same and interchangable<br />
</li>
<li>Consider aluminium for bus bars (lighter but more volume)</li>
</ul>
</section>
</section>
<section id="bus-bar-system-2-design" class="level2">
<h2>Bus Bar System 2 Design</h2>
</section>
<section id="bus-bar-system-2-considerations" class="level2">
<h2>Bus Bar System 2 Considerations</h2>
</section>
</section>
<section id="pack-3-option" class="level1">
<h1>Pack 3 Option</h1>
<section id="details-1" class="level2">
<h2>Details</h2>
<code><div class="sourceCode" id="cb1" data-exports="both" data-session="batt"
data-codefile="code.clj" data-results="output table"
data-scadfile="code.scad"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(printDims <span class="st">&quot;bc&quot;</span> battCase <span class="st">&quot;p3&quot;</span> pack3)</span></code></pre></div></code>
<div class="RESULTS drawer">
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>dimX (mm)</th>
<th>dimY (mm)</th>
<th>dimZ (mm)</th>
<th>Vol (cm3)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>bc</td>
<td>350</td>
<td>500</td>
<td>3</td>
<td>525</td>
</tr>
<tr class="even">
<td>p3</td>
<td>297.8</td>
<td>448.75</td>
<td>73.75</td>
<td>9855</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>bus bars are natural and "for free" and their function is only
balancing and ideally have minimal current passing through. fusing is
still possible but more difficult</p></li>
<li><p>central area can be a tube for protected balance leads</p></li>
<li><p>whole pack can be sandwiched using long screws?</p></li>
</ul>
<section id="fusing-1" class="level3">
<h3>Fusing</h3>
<p>Seems tricky but is actually doable, bus bars touch for current
transfer but cells can be indiviually fused.</p>
</section>
<section id="structural" class="level3">
<h3>Structural</h3>
<p>This is the main issue with this pack?</p>
</section>
</section>
<section id="model-1" class="level2">
<h2>Model</h2>
<code><div class="sourceCode" id="cb1" data-exports="both" data-axes="t"
data-session="batt" data-codefile="code.clj"
data-scadfile="code.scad"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(previewObj <span class="dv">300</span> pack3)</span></code></pre></div></code>
<div class="RESULTS drawer">
<p><img src="././3d/pack3.jpg" /></p>
</div>
<code><div class="sourceCode" id="cb1" data-exports="both" data-axes="t"
data-session="batt" data-codefile="code.clj"
data-scadfile="code.scad"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">:obj</span> (slapObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] <span class="dv">0</span> battCase (rotateObj [<span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span>] pack3)))</span></code></pre></div></code>
<div class="RESULTS drawer">
<p><img src="././3d/pack3_full.jpg" /></p>
</div>
</section>
<section id="bus-bar-design" class="level2">
<h2>Bus Bar Design</h2>
<p><a href="./pack3/">Separate design document for this is here</a></p>
<p>Slightly complex to have stacked per cell fuses but could be
doable<br />
<img src="./img/sketch_pack3_2.svg" /><br />
Some concerns with shorting bus bars and cascading failiure, <a
href="./pack3/">check the design doc for details</a></p>
</section>
</section>
<section id="other-details" class="level1">
<h1>Other Details</h1>
<section id="misc-safety" class="level2">
<h2>Misc safety</h2>
<ul>
<li>internal air quality monitoring<br />
</li>
<li>what is the approach to temperature monitoring given we can't have a
sensor on every cell?<br />
</li>
<li>how are we detecting an unusual temperature response?</li>
</ul>
</section>
<section id="cabling" class="level2">
<h2>Cabling</h2>
<ul>
<li>Building 2 batteries, 3.3kWh each (15-20kg each?)<br />
</li>
<li>Optionally can run on one battery, so independant systems, each
battery can take the full 150A load<br />
</li>
<li>Cabling as a part of the battery itself, plugs on the bike.</li>
</ul>
</section>
<section id="diagram" class="level2">
<h2>Diagram</h2>
<figure><pre>┌────────┐┌────────┐
│battery1││battery2│
└┬───────┘└┬───────┘
┌▽─────────▽┐       
│esc        │       
└┬──────────┘       
┌▽────┐             
│motor│             
└─────┘             

</pre></figure>
</section>
<section id="cables" class="level2">
<h2>Cables</h2>
<p>minimum 50mm² cables</p>
<p><span class="todo TODO">TODO</span> figure out insulation the
material and simulate thermals</p>
</section>
<section id="connectors" class="level2">
<h2>Connectors</h2>
<p>what type of connectors for the battery itself, for the bike?</p>
</section>
<section id="bus-bar-sizing" class="level2">
<h2>Bus bar sizing</h2>
<p>we can go for 75mm²-100mm² just to avoid estimated 70deg heating at
peaks within the battery.</p>
<p>20mm x 3-5mm<br />
or<br />
30mm x 2-3mm</p>
</section>
</section>
<section id="cell-level-fuse-research" class="level1">
<h1>Cell level fuse research</h1>
<p><u>Current conclusion is that worst case some sort of common nickel
strips will work well as fuses as well given these are high power cells
and will burn the strip in case of a cell level short, but need to
confirm with calculations and experiments</u></p>
<section id="figure-out-a-material" class="level3">
<h3><span class="todo TODO">TODO</span> Figure out a material</h3>
<p>considerations:</p>
<ul>
<li>connection to the cell<br />
</li>
<li>suitability to a role as a fuse (I assume this is melting point and
resistance, anything else?)</li>
</ul>
</section>
<section id="aluminium" class="level3">
<h3>Aluminium</h3>
<p>Seems like a common material for bus bars in pro setups, can it be
used for fusing as well?<br />
I suspect it won't be solid enough and vibration fatigue might damage
thin alu</p>
</section>
<section id="copper" class="level3">
<h3>Copper</h3>
<p>Welding to battery</p>
<ul>
<li>TODO spot?<br />
</li>
<li>TODO laser?</li>
</ul>
<p>Check:</p>
<figure><pre>- https://cellsaviors.com/blog/copper-nickel-sandwich
- https://cellsaviors.com/blog/can-you-spot-weld-copper
- https://www.copper.org/applications/marine/cuni/fabrication/joining_welding_cutting_lining.html
- https://endless-sphere.com/sphere/threads/copper-nickel-sandwich-buses-for-series-connections.108006/
- https://endless-sphere.com/sphere/threads/spot-welding-copper-strips-to-18650-battery-cells.84680/page-23
</pre></figure>
</section>
<section id="nickel" class="level3">
<h3>Nickel</h3>
<p>fuse test video<br />
<a
href="https://www.youtube.com/watch?v=BAPHF3Sq2t8">https://www.youtube.com/watch?v=BAPHF3Sq2t8</a></p>
<p>Spot welding to cell is easy</p>
<ul>
<li>TODO welding to copper bus bar?</li>
</ul>
<p>We expect each of our cells to be able to output 18.75A, how will a
2cm strip of nickel perform here?</p>
<details><summary> python code block</summary><code><div class="sourceCode" id="cb1" data-results="table"
data-exports="both" data-session="battcalc"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">**</span>material_nickel,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    current: <span class="fl">18.75</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    voltage: <span class="fl">4.2</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    temperature: <span class="dv">60</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    length: <span class="fl">0.02</span>, <span class="co"># 2cm</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> round_row(<span class="op">*</span>row):</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [ <span class="ss">f&quot;</span><span class="sc">{</span>item<span class="sc">:.2f}</span><span class="ss">&quot;</span> <span class="cf">for</span> item <span class="kw">in</span> row]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> [<span class="st">&quot;mm²&quot;</span>, <span class="st">&quot;A/mm²&quot;</span>, <span class="st">&quot;D (mm)&quot;</span>, <span class="st">&quot;Loss (W)&quot;</span>, <span class="st">&quot;Loss (%)&quot;</span>, <span class="st">&quot;ΔT (°C)&quot;</span>]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> area <span class="kw">in</span> np.linspace(<span class="dv">3</span>, <span class="dv">12</span>, <span class="dv">7</span>):</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    vals <span class="op">=</span> compute(</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        { <span class="op">**</span>values, area_mm2: area },</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        [ current_density, diameter_mm, power_loss, power_loss_percent, delta_t ])</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    rows.append(round_row(area, <span class="op">*</span>vals))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Return formatted table</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>[headers, <span class="op">*</span>rows]</span></code></pre></div></code></details>
<table>
<thead>
<tr class="header">
<th>mm²</th>
<th>A/mm²</th>
<th>D (mm)</th>
<th>Loss (W)</th>
<th>Loss (%)</th>
<th>ΔT (°C)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3.00</td>
<td>6.25</td>
<td>1.95</td>
<td>0.20</td>
<td>0.26</td>
<td>330.86</td>
</tr>
<tr class="even">
<td>4.50</td>
<td>4.17</td>
<td>2.39</td>
<td>0.14</td>
<td>0.17</td>
<td>180.10</td>
</tr>
<tr class="odd">
<td>6.00</td>
<td>3.12</td>
<td>2.76</td>
<td>0.10</td>
<td>0.13</td>
<td>116.98</td>
</tr>
<tr class="even">
<td>7.50</td>
<td>2.50</td>
<td>3.09</td>
<td>0.08</td>
<td>0.10</td>
<td>83.70</td>
</tr>
<tr class="odd">
<td>9.00</td>
<td>2.08</td>
<td>3.39</td>
<td>0.07</td>
<td>0.09</td>
<td>63.67</td>
</tr>
<tr class="even">
<td>10.50</td>
<td>1.79</td>
<td>3.66</td>
<td>0.06</td>
<td>0.07</td>
<td>50.53</td>
</tr>
<tr class="odd">
<td>12.00</td>
<td>1.56</td>
<td>3.91</td>
<td>0.05</td>
<td>0.06</td>
<td>41.36</td>
</tr>
</tbody>
</table>
<p>Standard nickel strip used in batteries is 8x0.75mm so 6mm² which
gives us 3.12A/mm²</p>
<p>Nickel has higher resistance, I'm not confident in my temp
calculations but this is worrysome, I need to validate this
experimentally. For now I will proceed with the assumption that I can
design good nickel fuses</p>
<p><a href="https://www.youtube.com/watch?v=cWQWDyBtgTs">soldering
video</a></p>
</section>
</section>
<section id="exports-for-drawing" class="level1">
<h1>Exports for drawing</h1>

</section>
<section id="resources" class="level1">
<h1>Resources</h1>
<p>check<br />
<a
href="https://www.youtube.com/watch?v=oNfTEHBz_bg&amp;t=261s">https://www.youtube.com/watch?v=oNfTEHBz_bg&amp;t=261s</a></p>
<p>batterydesign.net cylindrical cells, cooling<br />
<a
href="https://www.batterydesign.net/battery-cell/formats/cylindrical-cells/">https://www.batterydesign.net/battery-cell/formats/cylindrical-cells/</a></p>
<p>Lucid motors pack<br />
<a
href="https://www.batterydesign.net/lucid-motors/">https://www.batterydesign.net/lucid-motors/</a>
<a
href="https://www.youtube.com/watch?v=2aDyjJ5wj64">https://www.youtube.com/watch?v=2aDyjJ5wj64</a></p>
<p>Formula E battery<br />
<a
href="https://www.batterydesign.net/formula-e-battery-2019-21/">https://www.batterydesign.net/formula-e-battery-2019-21/</a></p>
<p>actually this might be amazing? wtf?<br />
<a
href="https://thebatteryshop.eu/EVE-LF100LA-LiFePO4-battery-cell-double-M6-thread">https://thebatteryshop.eu/EVE-LF100LA-LiFePO4-battery-cell-double-M6-thread</a><br />
100A output is a bit on the low end, also a bit scarry that it's an
unknown manufacturer</p>
<p>good mounts<br />
<a
href="https://ebikestuff.eu/en/20-cell-holders-21700">https://ebikestuff.eu/en/20-cell-holders-21700</a></p>
<p>can weld to alu<br />
<a
href="https://thebatteryshop.eu/Glitter-801H-spot-welder">https://thebatteryshop.eu/Glitter-801H-spot-welder</a></p>
</section> 
    <div class="debug-grid"></div>
    <script src="/index.js"></script>
  </body>
</html>
